
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/inclusionAI/AWorld/Quickstart/multi-agent_system_construction/">
      
      
        <link rel="prev" href="../workflow_construction/">
      
      
        <link rel="next" href="../agent_training/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Multi-agent System Construction - AWorld Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#building-and-running-multi-agent-systems-mas" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="AWorld Docs" class="md-header__button md-logo" aria-label="AWorld Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AWorld Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Multi-agent System Construction
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/inclusionAI/AWorld" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="AWorld Docs" class="md-nav__button md-logo" aria-label="AWorld Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AWorld Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/inclusionAI/AWorld" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Quickstart
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Quickstart
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../install/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Install
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent_construction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Construction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflow_construction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflow Construction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Multi-agent System Construction
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Multi-agent System Construction
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-mas-construction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick MAS Construction
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick MAS Construction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specifying-entry-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Specifying Entry Agent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actions-group-parallel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Actions Group Parallel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dynamic Routing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dynamic Routing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#two-examples-of-overriding-routing-react-and-plan-execute" class="md-nav__link">
    <span class="md-ellipsis">
      
        Two Examples of Overriding Routing: ReAct and Plan-Execute
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Two Examples of Overriding Routing: ReAct and Plan-Execute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#react" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReAct
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plan-execute" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plan-Execute
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#combination-and-recursion-of-mas-and-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Combination and Recursion of MAS and Workflow
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent_training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Agent Training
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#quick-mas-construction" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quick MAS Construction
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quick MAS Construction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specifying-entry-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Specifying Entry Agent
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actions-group-parallel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Actions Group Parallel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-routing" class="md-nav__link">
    <span class="md-ellipsis">
      
        Dynamic Routing
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dynamic Routing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#two-examples-of-overriding-routing-react-and-plan-execute" class="md-nav__link">
    <span class="md-ellipsis">
      
        Two Examples of Overriding Routing: ReAct and Plan-Execute
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Two Examples of Overriding Routing: ReAct and Plan-Execute">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#react" class="md-nav__link">
    <span class="md-ellipsis">
      
        ReAct
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plan-execute" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plan-Execute
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#combination-and-recursion-of-mas-and-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Combination and Recursion of MAS and Workflow
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="building-and-running-multi-agent-systems-mas">Building and Running Multi-Agent Systems (MAS)</h1>
<p>In the AWorld framework, similar to Workflow Construction, the fundamental building block for MAS is the Agent. By
introducing the Swarm concept, users can easily, quickly, and efficiently build complex Multi-Agent Systems. In summary:</p>
<ol>
<li><strong>Workflow in AWorld</strong>: Static, pre-defined execution flows</li>
<li><strong>MAS in AWorld</strong>: Dynamic, real-time decision-making execution flows</li>
</ol>
<p>This design ensures unified underlying capabilities (i.e., Agent, Graph-based Topology) while maintaining extensibility.</p>
<p>MAS uses event mechanism as the communication basis, where the output from the previous agent serves as the input for
the next agent.</p>
<h2 id="quick-mas-construction">Quick MAS Construction</h2>
<p>Similar to Workflows, we can easily define communication networks between Agents through topology. The key difference is
that by using <code>build_type=GraphBuildType.HANDOFF</code>, we allow dynamic decision-making for inter-agent calling
relationships:</p>
<ol>
<li><code>agent1</code> can selectively decide to call <code>agent2</code> and <code>agent3</code>; the number of calls is also dynamic (once or multiple
   times)</li>
<li><code>agent2</code> can selectively decide to call <code>agent3</code>; the number of calls is also dynamic (once or multiple times)</li>
</ol>
<pre><code class="language-python">from aworld.config.conf import AgentConfig
from aworld.agents.llm_agent import Agent
from aworld.core.agent.swarm import Swarm, GraphBuildType
from aworld.runner import Runners

# Configure agents
agent_conf = AgentConfig(...)
agent1 = Agent(name=&quot;agent1&quot;, conf=agent_conf)
agent2 = Agent(name=&quot;agent2&quot;, conf=agent_conf)
agent3 = Agent(name=&quot;agent3&quot;, conf=agent_conf)

# Create swarm with dynamic handoff topology
swarm = Swarm(
    topology=[(agent1, agent2), (agent2, agent3), (agent1, agent3)],
    build_type=GraphBuildType.HANDOFF
)

# Run the swarm
Runners.run(input=&quot;your question&quot;, swarm=swarm)
</code></pre>
<h3 id="specifying-entry-agent">Specifying Entry Agent</h3>
<p>Since MAS is essentially a Graph by definition, different Agents can accept external input. We can specify which Agent
receives the query using the <code>root_agent</code> parameter.</p>
<pre><code class="language-python">swarm = Swarm(
    topology=[(agent1, agent2), (agent2, agent3), (agent1, agent3)],
    build_type=GraphBuildType.HANDOFF,
    root_agent=[agent1]
)
</code></pre>
<h3 id="actions-group-parallel">Actions Group Parallel</h3>
<p>The agent's policy may have multiple actions on a decision, including local tools, MCP tools, and agents.
AWorld will merge these actions of the same type and automatically parallelize them. The results of parallel execution
will be automatically merged and returned to the agent.</p>
<p>If you have a custom policy for mixing different types of actions (tools, agents) in parallel, <code>GroupMessage</code> events can
be used in <code>async_post_run()</code> or <code>post_run()</code> of <code>Agent</code>.</p>
<pre><code class="language-python">import uuid
from aworld.core.event.base import GroupMessage, TopicType, Message


def async_post_run(self,
                   policy_result,
                   policy_input,
                   message) -&gt; Message:
    your_actions = [tool1_action1, tool1_action2, agent1, agent2, tool2_action]
    group_id = f&quot;agent_id_{uuid.uuid1().hex}&quot;

    # The setting of other parameters can refer to the implementation of the Agent
    return GroupMessage(payload=your_actions,
                        caller=...,
                        sender=...,
                        session_id=...,
                        group_id=group_id,
                        topic=TopicType.GROUP_ACTIONS,
                        headers=...)


</code></pre>
<h3 id="dynamic-routing">Dynamic Routing</h3>
<p>When the <code>async_policy()</code> or <code>policy()</code> function decides which agent to call next, for special cases, Agents may need
customized routing based on specific business rules. You can override the handler in the corresponding Agent:</p>
<pre><code class="language-python"># Handler name consistency must be maintained
agent = Agent(..., event_handler_name=&quot;your_handler_name&quot;)
</code></pre>
<pre><code class="language-python">from aworld.runners import HandlerFactory
from aworld.runners.handler import DefaultHandler
from aworld.core.event.base import Message, ToolMessage, AgentMessage
from typing import AsyncGenerator


@HandlerFactory.register(name=&quot;your_handler_name&quot;)
class YourHandler(DefaultHandler):
    def is_valid_message(self, message: Message) -&gt; bool:
        return message.category == &quot;your_handler_name&quot;

    async def _do_handle(self, message: Message) -&gt; AsyncGenerator[Message, None]:
        if not self.is_valid_message(message):
            return

        # The type of data is generally ActionModel, but can be customized
        data = message.payload[0]
        content = data.policy_info

        if &quot;use_tool1&quot; in content:
            # not tool call, but want to use tools
            yield ToolMessage(
                payload=...,
                caller=...,
                sender=...,
                receiver=&quot;tool1&quot;,
                session_id=...,
                headers=...
            )
        elif &quot;use_agent1&quot; in data:
            # want to use agent as next step
            yield AgentMessage(
                payload=...,
                caller=...,
                sender=...,
                receiver=&quot;agent1&quot;,
                session_id=...,
                headers=...
            )
        else:
            ...
</code></pre>
<p>You can refer to the implementation of <code>DefaultTaskHandler</code> in AWorld.</p>
<h4 id="two-examples-of-overriding-routing-react-and-plan-execute">Two Examples of Overriding Routing: ReAct and Plan-Execute</h4>
<h5 id="react">ReAct</h5>
<pre><code class="language-python">@HandlerFactory.register(name='react')
class ReactHandler(AgentHandler):
    def is_valid_message(self, message: Message):
        if message.category != 'react':
            return False
        return True

    async def _do_handle(self, message: Message) -&gt; AsyncGenerator[Message, None]:
        yield message
</code></pre>
<h5 id="plan-execute">Plan-Execute</h5>
<p>Compared to ReAct, agent2 and agent3 can execute in parallel simultaneously.</p>
<pre><code class="language-python">from aworld.core.common import Observation
from aworld.core.event.base import AgentMessage
from aworld.logs.util import logger


@HandlerFactory.register(name='plan_execute')
class PlanExecuteHandler(AgentHandler):
    def is_valid_message(self, message: Message):
        if message.category != 'plan_execute':
            return False
        return True

    async def _do_handle(self, message: Message) -&gt; AsyncGenerator[Message, None]:
        logger.info(f&quot;PlanExecuteHandler|handle|taskid={self.task_id}|is_sub_task={message.context._task.is_sub_task}&quot;)
        content = message.payload

        # Parse model plan
        plan = parse_plan(content[0].policy_info)
        logger.info(f&quot;PlanExecuteHandler|plan|{plan}&quot;)

        # Execute steps
        output, context = execution_steps(plan.steps)

        # Send event message, notify the next processing agent
        new_plan_input = Observation(content=output)
        yield AgentMessage(
            session_id=message.session_id,
            payload=new_plan_input,
            sender=self.name(),
            receiver=self.swarm.communicate_agent.id(),
            headers={'context': context}
        )
</code></pre>
<p>For more details, refer to the examples.</p>
<h2 id="combination-and-recursion-of-mas-and-workflow">Combination and Recursion of MAS and Workflow</h2>
<p>Same or different types of Swarms can be deeply nested, providing multi-level Swarms with different interaction
mechanisms to support complex multi-agent interactions. For example, when creating a travel itinerary planner, using a
combination of Workflow + MAS, where Workflow provides deterministic processes and MAS handles multi-source information
retrieval and integration.</p>
<pre><code class="language-python">from aworld.config.conf import AgentConfig
from aworld.agents.llm_agent import Agent
from aworld.core.agent.swarm import Swarm, GraphBuildType

# Configure agents
agent_conf = AgentConfig(...)

# Create five agents
rewrite = Agent(name=&quot;rewrite&quot;, conf=agent_conf)
plan = Agent(name=&quot;plan&quot;, conf=agent_conf)
search = Agent(name=&quot;search&quot;, conf=agent_conf)
summary = Agent(name=&quot;summary&quot;, conf=agent_conf)
report = Agent(name=&quot;report&quot;, conf=agent_conf)

# Construct a MAS
mas = Swarm(
    topology=[(plan, search), (plan, summary)],
    build_type=GraphBuildType.HANDOFF,
    root_agent=[plan]
)

# Construct a combination of a workflow with the MAS team
combination = Swarm(
    topology=[(rewrite, mas), (mas, report)],
    root_agent=[rewrite]
)
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Â© Copyright 2025 inclusionAI AWorld Team.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../js/hide-home-edit.js"></script>
      
    
  </body>
</html>